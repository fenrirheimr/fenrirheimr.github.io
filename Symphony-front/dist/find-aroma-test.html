<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>Symphony</title>
  <meta name="description" content="Symphony front-end">
  <meta name="author" content="Владимир Глушков">
  
  <!--<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">-->
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
  <link rel="stylesheet" href="css/style.css">

  <!--[if lt IE 9]>
  <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
</head>

<body>
<!--//= partials/loader.html-->
<nav class="navbar navbar-toggleable-md navbar-light bg-faded py-0">
  <button class="navbar-toggler navbar-toggler-left py-0 px-0" type="button" data-toggle="collapse" data-target="#topNav" aria-controls="topNav" aria-expanded="false" aria-label="Toggle navigation">
    <div class="toggle-btn">
      <span></span>
      <span></span>
      <span></span>
      <span></span>
    </div>
  </button>
  
  <div class="navbar-nav top-nav-mobile hidden-lg-up">
    <a class="nav-link logo align-self-center py-0" href="#"><img src="img/logo.png"></a>
  </div>
  
  <div class="collapse navbar-collapse" id="topNav">
    <ul class="navbar-nav container justify-content-between top-nav px-0">
      <li class="nav-item">
        <a class="nav-link" href="catalog.html">Каталог</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="games.html">Атмосфера в доме</a>
      </li>
      <li class="nav-item align-self-start hidden-md-down">
        <a class="nav-link logo" href="/"><img src="img/logo.png"></a>
      </li>
    
      <li class="nav-item">
        <a class="nav-link" href="map.html">Где купить</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="article.html">Ароматы</a>
      </li>
    </ul>
  </div>
</nav>


<div class="container">
	
	<div class="row justify-content-center">

		<div class="aroma-test"></div>
		
	</div>
	
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
<script src="http://api-maps.yandex.ru/2.1/?lang=ru_RU" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.16.1/TweenMax.min.js" type="text/javascript"></script>
<script src="js/main.js"></script>

<script type="text/javascript">
	
	(function($){
		$.fn.extend({
			jQuizler: function(questions) {
				// @todo избавиться от возможности двойного клика по кнопкам "cследующий", "предыдущий", "результат"
				// @todo добавить возможность выбора нескольких вариантов ответа
				// @todo добавить возможность внедрения названия теста на страницу результатов
				// @todo избавиться от зависимости Bootsrap CSS
				// @todo поработать над стилем элементов кнопок и прогресса
				// @todo добавить кнопки "поделиться" или "like" для разных соц сетей ("ВКонтакте", "Однолкассники", ...)
				// @todo разобраться с проблемой клика по элементу кнопки на странице результатов
				// @todo переписать код, сделать его более изящным и чистым
				// @todo сделать так, чтобы плагин можно было применять для 2х и более тестов на страницу
				// @todo создать online инструмент для формирования и редактирования вопросов
				
				if (questions == null)
					throw 'No questions was provided.';
				
				var reviewQuiz = false;
				
				var percentage = 0;
				var percentPiece = 100 / questions.length;
				
				var rightAnswers = 0;
				
				$(this).html("<div class=\"intro\">" + $(this).html() + "</div>");
				
				$(this).click(function(){
					$(this).off('click');
					
					$(".intro").hide();
					$(this).css("text-align", "left");
					$('.progress').css("display", "block");
					
					var question = $("#question-1");
					
					question.css({opacity : '0', height : '0px'});
					
					question.animate({
						opacity : '1',
						height : '100%'
					}, 500, function(e){});
					
					question.css('display', 'block');
					
					percentage += percentPiece;
					$(".progress div").css("width", percentage + "%");
				});
				
				(function($){
					$.shuffle = function(arr) {
						for(
							var j, x, i = arr.length; i;
							j = parseInt(Math.random() * i),
								x = arr[--i], arr[i] = arr[j], arr[j] = x
						);
						return arr;
					}
				})(jQuery);
				
				String.prototype.replaceAll = function (find, replace) {
					var str = this;
					return str.replace(new RegExp(find, 'g'), replace);
				};
				
				return this.each(function(){
					var html = "";
					
					html += "<div class=\"results slide-container question\" style=\"display:none\"></div>";
					
					
					
					$.each(questions, function(index, question){
						html += "<div id=\"question-" + (index + 1) + "\" class=\"slide-container question\">";
						//html += "<div class=\"question-number\">Вопрос " + (index + 1) + ' из ' + questions.length + "</div><div style=\"margin:0px; clear:both\"></div>";
						
						html += question.question;
						
						var correctAnswers = [];
						for (var i = 0; i < question.correct.length; i++)
							correctAnswers.push(question.answers[question.correct[i] - 1]);
						
						question.answers = $.shuffle(question.answers);
						
						var correctAnswersNewIndexes = [];
						for (var i = 0; i < question.correct.length; i++)
							correctAnswersNewIndexes.push(question.answers.indexOf(correctAnswers[i]));
						
						question.correct = correctAnswersNewIndexes;
						
						/*for (var i = 0; i < question.correct.length; i++)
						 console.log(question.answers[correctAnswersNewIndexes[i]]);*/
						
						html += "<ul class=\"answers\">";
						
						for (var i = 0; i < question.answers.length; i++)
							html += "<li class=\"btn\">" + question.answers[i] + "</li>";
						
						html += "</ul>";
						html += "<div class=\"nav-container\">";
						
						html += "<div class=\"notice alert alert-info\">Выберите ответ</div>";
						
						if (index != 0) {
							html += "<button class=\"prev btn btn-info\"><i class='icon-arrow-left icon-white'></i> Предыдущий</button>";
						}
						
						if (index != questions.length-1) {
							html += "<button class=\"next btn btn-success\">Следующий <i class='icon-arrow-right icon-white'></i></button>";
							html += "<div style=\"clear:both\"></div>";
							
						} else {
							html += "<button class=\"final btn btn-success\">� езультат <i class='icon-ok icon-white'></i></button>";
							html += "<div style=\"clear:both\"></div>";
						}
						
						html += "</div></div>";
						
						html += "</div>";
					});
					
					
					
					html += "<div class=\"progress progress-info progress-striped\">";
					html += "<div id=\"percent\" class=\"bar\" style=\"width: 0%;\"></div>";
					html += "</div>";
					
					///html += "<div style=\"margin:0px; clear:both\"></div>";
					$(this).append(html);
					
					$("div[id*='question-'] li").click(function(){
						if (!reviewQuiz) {
							/*$(this).siblings().removeClass("selected");
							 $(this).toggleClass("selected");*/
							
							$(this).siblings().removeClass("btn-info");
							$(this).toggleClass("btn-info");
						}
					});
					
					
					
					$(".final").click(function(e){
						var div = $(e.target).closest("div[id*='question-']");
						var userAnswer = div.find("li.btn-info");
						
						if (userAnswer.index() == -1 && !reviewQuiz) {
							var notice = div.find(".notice");
							notice.css('opacity', '0');
							
							notice.animate({
								opacity: 1
							}, 500, function(){});
							
							div.find(".notice").css('display', 'block');
						} else if (!reviewQuiz) {
							div.find(".notice").css('display', 'none');
							
							percentage += percentPiece;
							if (percentage > 100) percentage = 100;
							$("#percent").css("width", percentage + "%");
							
							var resultHTML = "<h3 style=\"text-align: center\">� ЕЗУЛЬТАТЫ</h3>";
							
							var buttonsHTML = '';
							$.each(questions, function(index, question){
								//console.log("Правильные ответы: " + question.correct);
								
								var element = $("#question-" + (index+1) + " ul li.btn-info");
								//console.log("Ответ пользователя: " + element.index());
								
								if (element.index() == question.correct) {
									element.removeClass("btn-info");
									element.addClass("btn-success");
									
									buttonsHTML += "<button class=\"btn btn-success\"><i class='icon-ok-sign icon-white'></i> Вопрос " + (index+1) + "</button>";
									rightAnswers++;
								} else {
									element.removeClass("btn-info");
									element.addClass("btn-danger");
									
									buttonsHTML += "<button class=\"btn btn-danger\"><i class='icon-remove-sign icon-white'></i> Вопрос " + (index+1) + "</button>";
									
									for (var i=0; i<question.correct.length; i++) {
										element.parent().find('li').eq(question.correct[i]).addClass("btn-success");
									}
								}
							});
							
							resultHTML += "<p style=\"margin: 14px 0px\">Вы ответили на " + Math.round(((rightAnswers * 100) / questions.length) * 100) / 100 + "% вопросов.</p>";
							resultHTML += buttonsHTML;
							resultHTML += "<p style=\"margin-top:25px; text-align: center\"><button class=\"btn btn-large tostart\">Просмотреть вопросы</button></p>";
							
							div.animate({
								opacity : '0'
							}, 500, function(e){
								div.css('display', 'none');
								div.find(".notice").css('display', 'none');
								
								$(".results").append(resultHTML);
								$(".results").css("opacity", "0");
								$(".results").css("display", "block");
								
								$(".results").animate({
									opacity : '1'
								}, 500, function(e){
								});
							});
							
							$(".progress").animate({
								opacity : '0'
							}, 100, function(e){});
							
							reviewQuiz = true;
						} else {
							$(".results").animate({
								opacity: "1",
								display: "block"
							}, 100, function(e){});
							
							div.animate({
								opacity : '0'
							}, 500, function(e){
								div.css('display', 'none');
								div.find(".notice").css('display', 'none');
								
								$(".results").append(resultHTML);
								$(".results").css("opacity", "0");
								$(".results").css("display", "block");
								
								$(".results").animate({
									opacity : '1'
								}, 500, function(e){
								});
							});
							
							$(".progress").animate({
								opacity : '0'
							}, 100, function(e){});
						}
						
						return false;
					});
					
					$(".next").click(function(e){
						var div = $(e.target).closest("div[id*='question-']");
						var userAnswer = div.find("li.btn-info");
						
						if (userAnswer.index() == -1 && !reviewQuiz) {
							var notice = div.find(".notice");
							notice.css('opacity', '0');
							
							notice.animate({
								opacity: 1
							}, 500, function(){});
							
							div.find(".notice").css('display', 'block');
						} else {
							
							var nextId = parseInt(div.attr('id').replace('question-', '')) + 1;
							//console.log(nextId);
							
							var newQuestion = $("#question-" + nextId);
							
							div.animate({
								opacity : '0'
							}, 500, function(e){
								div.css('display', 'none');
								div.find(".notice").css('display', 'none');
								
								newQuestion.css({opacity : '0', height : '0px'});
								
								newQuestion.animate({
									opacity : '1',
									height : '100%'
								}, 500, function(e){});
								
								newQuestion.css('display', 'block');
							});
							
							percentage += percentPiece;
							$(".progress div").css("width", percentage + "%");
						}
						
						return false;
					});
					
					$(".prev").click(function(e){
						var div = $(e.target).closest("div[id*='question-']");
						
						var prevId = parseInt(div.attr('id').replace('question-', '')) - 1;
						
						var newQuestion = $("#question-" + prevId);
						
						div.animate({
							opacity : '0'
						}, 500, function(e){
							div.css('display', 'none');
							//div.find(".notice").css('display', 'none');
							
							newQuestion.css({opacity : '0', height : '0px'});
							
							newQuestion.animate({
								opacity : '1',
								height : '100%'
							}, 500, function(e){});
							
							newQuestion.css('display', 'block');
						});
						
						percentage -= percentPiece;
						$(".progress div").css("width", percentage + "%");
						
						return false;
					});
					
					$(".results").click(function(e){
						$(".results").animate({opacity: 0}, 500, function(e){
							$(".results").css("display", "none");
							
							var question = $("#question-1");
							
							question.css({opacity : '0', height : '0px'});
							
							question.animate({
								opacity : '1',
								height : '100%'
							}, 500, function(e){});
							
							question.css('display', 'block');
							
							$(".progress div").css("width", "0");
							$(".progress div").css("display", "block");
							$(".progress").animate({
								opacity : '1'
							}, 300, function(e){
								percentage = 0;
								percentage += percentPiece;
								$(".progress div").css("width", percentage + "%");
							});
						});
					});
				});
			}
		});
		
		
	})(jQuery);
	
	$("document").ready(function(){
		
//		var questions = 'js/findAromaTest.json';
		var questions = [
				{
					"type": "choose",
					"question": "<h3>Какое утверждение истинно?</h3>",
					"answers": [
						"jQuery - это JSON библиотека",
						"jQuery - это JavaScript библиотека"
					],
					"correct": [2]
				},
				{
					"type": "choose",
					"question": "<h3>Какое утверждение истинно?</h3>",
					"answers": [
						"jQuery - это JSON библиотека",
						"jQuery - это JavaScript библиотека"
					],
					"correct": [2]
				},
				{
					"type": "choose",
					"question": "<h3>Какое утверждение истинно?</h3>",
					"answers": [
						"jQuery - это JSON библиотека",
						"jQuery - это JavaScript библиотека"
					],
					"correct": [2]
				},
				{
					"type": "choose",
					"question": "<h3>Какое утверждение истинно?</h3>",
					"answers": [
						"jQuery - это JSON библиотека",
						"jQuery - это JavaScript библиотека"
					],
					"correct": [2]
				},
				{
					"type": "choose",
					"question": "<h3>Какое утверждение истинно?</h3>",
					"answers": [
						"jQuery - это JSON библиотека",
						"jQuery - это JavaScript библиотека"
					],
					"correct": [2]
				}
			];
		
		$(".aroma-test").jQuizler(questions);
	});
</script>


</body>

</html>